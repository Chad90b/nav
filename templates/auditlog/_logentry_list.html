<table id="auditlog" class="listtable full-width">
  <thead>
    <tr>
      <th>Timestamp</th>
      <th>Actor</th>
      <th>Verb</th>
      <th>Object</th>
      <th>Target</th>
      <th>Summary</th>
    </tr>
  </thead>
</table>
<script type="text/javascript">
 require(['libs/datatables.min'], function(){
     var api_parameters = {{ auditlog_api_parameters|safe|default:'{}' }};
     var columns = {
         0: 'timestamp',
         1: 'actor',
         2: 'verb',
         3: 'object',
         4: 'target',
         5: 'summary'
     };
     var dt_config = {
         serverSide: true,
         ajax: {
             url: '/api/1/auditlog/',
             data: function(d) {
                 // Override the original parameters that we get when using serverSide rendering
                 var parameters = {
                     page: d.start / d.length + 1,
                     page_size: d.length,
                     ordering: d.order.map(function(order) {
                         var direction = order.dir === 'asc' ? '' : '-';
                         return direction + columns[order.column];
                     }).join(',')
                 }
                 return Object.assign({}, parameters, api_parameters);
             },
             dataFilter: function(data) {
                 // Map the response to something datatables understands
                 var json = jQuery.parseJSON( data );
                 json.recordsTotal = json.count;
                 json.recordsFiltered = json.count;
                 json.data = json.results;
                 return JSON.stringify( json );
             }
         },
         columns: [
             { 'data': columns[0] },
             { 'data': columns[1] },
             { 'data': columns[2] },
             { 'data': columns[3] },
             { 'data': columns[4] },
             { 'data': columns[5] }
         ],
         bAutoWidth: false,
         bFilter: false,
         bInfo: false,
         bSort: true,
         order: [[0, 'desc']],
         paging: true,
         pagingType: 'full_numbers',
         lengthChange: true,  // Change number of visible rows
         lengthMenu: [
             [10, 25, 50, -1],   // Choices for number of rows to display
             [10, 25, 50, "All"] // Text for the choices
         ],
         drawCallback: drawCallback,
     };

     $('table#auditlog').DataTable(dt_config);
     function drawCallback(oSettings) {
         $('.paginate_button').removeClass('secondary').addClass('button tiny');
         $('.paginate_button.current').addClass('secondary');
         $('.ellipsis').addClass('button tiny secondary disabled paginate_button');
     }

 });
</script>
